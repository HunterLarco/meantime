<!DOCTYPE html>
<style>
div.canvas{
  position:absolute;
  top:0px;
  left:0px;
  right:0px;
  bottom:0px;
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-pack: center;
  -webkit-box-align: center;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-pack: center;
  -moz-box-align: center;
  display: box;
  box-orient: horizontal;
  box-pack: center;
  box-align: center;
}
canvas{
  width:256px;
  height:256px;
}
</style>
<html>
<head>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
<title>Sealed</title>

<div class='canvas'>
  <canvas id='icon' height='512' width='512'></canvas>
</div>

<script type='text/javascript'>


window.onload = function(){
  var img = new Image();
  img.onload = Render;
  img.src = './empty.png';
  
  var canvas = document.getElementById('icon'),
      ctx = canvas.getContext('2d'),
      width = canvas.width,
      height = canvas.height;
  
  var alpha = 0,
      time = 0,
      rotation = 0;
  
  function Sigmoid(x,width){
    function resizeSigmoid(x,width){
      var normalization = 1/(rawSigmoid(width,width)-rawSigmoid(0,width));
      return (rawSigmoid(x,width)-rawSigmoid(0,width))*normalization;
    }
    function rawSigmoid(x,width){
      width /= 2;
      return 1/(1+Math.exp(-6/width*(x-width)));
    }
    function limitSigmoid(val){
      function max(v,l){
        return l-(l-v+Math.abs(l-v))/2;
      }
      function min(v,l){
        return (v-l+Math.abs(v-l))/2+l;
      }
      return max(min(val,0),1);
    }
    return limitSigmoid(resizeSigmoid(x,width));
  }
  
  function Render(){
    ctx.clearRect(0,0,width,height);
    ctx.fillStyle = 'rgb(255,246,209)';
    ctx.strokeStyle = 'rgb(255,246,209)';
    var globalrotation = Sigmoid(rotation, 1)*-Math.PI;
    
    ctx.save();
    ctx.translate(width/2, height/2);
    ctx.rotate(globalrotation);
    ctx.translate(-width/2, -height/2);
    
    
    ctx.save();
    ctx.translate(width/2, height*(1/2-144/512+time*144/512));
    ctx.rotate(alpha);
    ctx.fillRect(-width/2, 0, width, height);
    ctx.restore();
    ctx.clearRect(0,height/2,width,height);
    
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(width/2, height/2);
    ctx.lineTo(width/2-height/3*Math.cos(alpha-Math.PI/2-globalrotation), height/2-height/3*Math.sin(alpha-Math.PI/2-globalrotation));
    ctx.stroke();
    
    ctx.save();
    ctx.translate(width/2, height*(1/2+144/512-time*144/512));
    ctx.rotate(alpha);
    ctx.fillRect(-width/2, 0, width, height);
    ctx.restore();
    ctx.clearRect(0,height/2+144/512*height,width,height);
    
    ctx.clearRect(0,0,width/2-width*144/512,height);
    ctx.clearRect(width/2+width*144/512,0,width,height);
    
    ctx.drawImage(img,0,0,width,height);
    
    ctx.restore();
    
    if(time < 1){
      time += 0.005;
    }else if(rotation < 1){
      time = 1;
      rotation += 0.02;
    }else{
      time = 0;
      rotation = 0;
    }
    requestAnimationFrame(Render);
  }
  
  window.ondevicemotion = function(event) {  
    var accelerationX = event.accelerationIncludingGravity.x;  
    // var accelerationY = event.accelerationIncludingGravity.y;
    // var accelerationZ = event.accelerationIncludingGravity.z;
    alpha = (alpha + -accelerationX/16) / 2;
  }
}


</script>
</body>
</html>
