<!DOCTYPE html>
<style>
div.body{
  padding:40px 0px 20px 0px;
}
div.body div.frame{
  margin:60px 0px;
  font-family:'raleway';
  font-weight:100;
  text-align:center;
}
div.body div.frame div.text{
  font-size:46px;
  padding:60px 0px;
  color:rgb(180,180,180);
  cursor:default;
}
div.body div.frame div.beta{
  border-top:    1px solid rgb(220,220,220);
  border-bottom: 1px solid rgb(220,220,220);
  padding:6px 0px;
  color:rgb(200,200,200);
  font-size:18px;
  width:500px;;
  display:block;
  margin:0px auto;
  cursor:default;
}
div.body div.frame input{
  border:none;
  outline:none;
  color:rgb(51,51,51);
  font-size:18px;
  font-weight:100;
  border-bottom:1px solid rgb(220,220,220);
  padding:6px 0px;
  text-align:center;
  width:400px;
  display:block;
  margin:0px auto;
  cursor:text;
  -webkit-transition: color 500ms ease 250ms;
  -moz-transition:    color 500ms ease 250ms;
  -ms-transition:     color 500ms ease 250ms;
  -o-transition:      color 500ms ease 250ms;
  transition:         color 500ms ease 250ms;
}
div.body div.frame input:disabled{
  cursor:not-allowed;
  color:rgb(200,200,200);
}
div.body div.frame button{
  border:none;
  outline:none;
  display:block;
  position:relative;
  padding:5px 0px;
  border-bottom:3px solid rgb(82,181,195);
  -webkit-border-radius: 3px;
  -moz-border-radius:    3px;
  border-radius:         3px;
  background:rgb(102,201,215);
  color:rgb(255,255,255);
  outline:none;
  cursor:pointer;
  text-align:center;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  margin-top:20px;
  width:100px;
  margin-left:auto;
  margin-right:auto;
  -webkit-transition: opacity 500ms ease;
  -moz-transition:    opacity 500ms ease;
  -ms-transition:     opacity 500ms ease;
  -o-transition:      opacity 500ms ease;
  transition:         opacity 500ms ease;
}
div.body div.frame button:not(:disabled):hover{
  border-bottom:2px solid rgb(82,181,195);
  margin-top:21px;
}
div.body div.frame button:not(:disabled):active{
  border-bottom:1px solid rgb(82,181,195);
  margin-top:22px;
}
div.body div.frame button:disabled{
  opacity:0.6;
  cursor:not-allowed;
  -webkit-transition: opacity 500ms ease 250ms;
  -moz-transition:    opacity 500ms ease 250ms;
  -ms-transition:     opacity 500ms ease 250ms;
  -o-transition:      opacity 500ms ease 250ms;
  transition:         opacity 500ms ease 250ms;
}
div.body div.frame div.content{
  border-bottom:1px solid rgb(220,220,220);
  color:rgb(51,51,51);
  width:360px;
  padding:14px;
  text-align:center;
  display:none;
  margin:0px auto;
  opacity:0;
  line-height:24px;
}

</style>
<html>
<head>
<meta charset="utf-8" />
<title>Try Sealed</title>
<link rel="stylesheet" href="/resources/CSS/resets.css"/>
<link rel='stylesheet' href='/resources/CSS/raleway.css'/>
<script src='/resources/Scripts/Request.js'></script>
<script src='/resources/Scripts/Transition.js'></script>
</head>
<body>


<div class='body'>
  <div class='frame'>
    <canvas id='icon' height='250' width='250'></canvas>
    <div class='text'>sealed</div>
    <div class='beta'><i>sign up to be a beta tester!</i></div>
    <div class='form' id='form'>
      <input type='text' autocomplete='off' id='email' placeholder='email'/>
      <button disabled class='button' id='button'>sign up</button>
    </div>
    <div class='content' id='content'>Thank you for trying sealed. We will be contacting you shortly and hope to hear from you in the future!</div>
    <div class='content' id='error'>This is embarrassing, something went wrong. Take a deep breath and please try again.</div>
    <div class='content' id='exists'>It seems you've already signed up! We're sorry if you haven't heard from us recently, but we haven't forgotten about you. Sit tight and we'll let you know the next steps soon.</div>
  </div>
</div>


<script type='text/javascript'>

window.onload = function(){
  LoadForm();
  InitIcon();
}




function LoadForm(){
  var form = document.getElementById('form'),
      input = document.getElementById('email'),
      button = document.getElementById('button'),
      content = document.getElementById('content'),
      error = document.getElementById('error'),
      exists = document.getElementById('exists');
  form.removeAttribute('id');
  input.removeAttribute('id');
  button.removeAttribute('id');
  content.removeAttribute('id');
  error.removeAttribute('id');
  exists.removeAttribute('id');
  
  button.addEventListener('click', OnSubmit);
  input.addEventListener('keyup', CheckEmail);
  input.addEventListener('focus', RemovePlaceholder);
  input.addEventListener('blur', AddPlaceholder);
  
  function RemovePlaceholder(){
    if(input.value.length == 0)
      input.removeAttribute('placeholder');
  }
  function AddPlaceholder(){
    if(input.value.length == 0)
      input.setAttribute('placeholder', 'email');
  }
  
  function CheckEmail(event){
    button.disabled = !isValidEmail(input.value);
    if(event.which == 13) OnSubmit();
  }
  
  function OnSubmit(){
    if(button.disabled) return;
    button.disabled = input.disabled = true;
    
    setTimeout(function(){
      var request = new Request('/api/alpha/signup')
      function OnSuccess(event){
        if(event.stat == 'fail'){
          if(event.code == 200)
            ShowResponse(exists);
          return;
        }
        ShowResponse(content);
      }
      function OnError(event){
        ShowResponse(error);
      }
      request.post({
        email: input.value
      }, OnSuccess, OnError);
    }, 900);
    
    function ShowResponse(elem){
      Transition.EaseInOut(400, function(percent){
        form.style.marginTop = Math.round(50*percent*10)/10 + 'px';
        form.style.opacity = 1-percent;
      }, function(){
        elem.style.display = 'block';
        form.style.display = 'none';
        setTimeout(function(){
          Transition.EaseInOut(400, function(percent){
            elem.style.opacity = percent;
          });
        },300);
      });
    }
  }
  
  
  function isValidEmail(email) { 
      var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(email);
  }
}



function InitIcon(){
  var img = new Image();
  img.onload = Render;
  img.src = '/images/empty.png';
  
  var canvas = document.getElementById('icon'),
      ctx = canvas.getContext('2d'),
      width = canvas.width,
      height = canvas.height;
  
  var alpha = 0,
      time = 0,
      rotation = 0;
  
  function Sigmoid(x,width){
    function resizeSigmoid(x,width){
      var normalization = 1/(rawSigmoid(width,width)-rawSigmoid(0,width));
      return (rawSigmoid(x,width)-rawSigmoid(0,width))*normalization;
    }
    function rawSigmoid(x,width){
      width /= 2;
      return 1/(1+Math.exp(-6/width*(x-width)));
    }
    function limitSigmoid(val){
      function max(v,l){
        return l-(l-v+Math.abs(l-v))/2;
      }
      function min(v,l){
        return (v-l+Math.abs(v-l))/2+l;
      }
      return max(min(val,0),1);
    }
    return limitSigmoid(resizeSigmoid(x,width));
  }
  
  function Render(){
    ctx.clearRect(0,0,width,height);
    ctx.fillStyle = 'rgb(255,246,209)';
    ctx.strokeStyle = 'rgb(255,246,209)';
    var globalrotation = Sigmoid(rotation, 1)*-Math.PI;
    
    ctx.save();
    ctx.translate(width/2, height/2);
    ctx.rotate(globalrotation);
    ctx.translate(-width/2, -height/2);
    
    
    ctx.save();
    ctx.translate(width/2, height*(1/2-144/512+time*144/512));
    ctx.rotate(alpha);
    ctx.fillRect(-width/2, 0, width, height);
    ctx.restore();
    ctx.clearRect(0,height/2,width,height);
    
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(width/2, height/2);
    ctx.lineTo(width/2-height/3*Math.cos(alpha-Math.PI/2-globalrotation), height/2-height/3*Math.sin(alpha-Math.PI/2-globalrotation));
    ctx.stroke();
    
    ctx.save();
    ctx.translate(width/2, height*(1/2+144/512-time*144/512));
    ctx.rotate(alpha);
    ctx.fillRect(-width/2, 0, width, height);
    ctx.restore();
    ctx.clearRect(0,height/2+144/512*height,width,height);
    
    ctx.clearRect(0,0,width/2-width*144/512,height);
    ctx.clearRect(width/2+width*144/512,0,width,height);
    
    ctx.drawImage(img,0,0,width,height);
    
    ctx.restore();
    
    if(time < 1){
      time += 0.002;
    }else if(rotation < 1){
      time = 1;
      rotation += 0.02;
    }else{
      time = 0;
      rotation = 0;
    }
    requestAnimationFrame(Render);
  }
}

</script>
</body>
</html>
