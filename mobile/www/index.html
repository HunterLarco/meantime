<!DOCTYPE html>
<style>
body {
    font-size:12px;
    margin:0px;
    padding:0px;
    overflow:hidden;
    font-family:'lato';
    font-weight:300;
}


div.statusbar{
  position:fixed;
  top:0px;
  left:0px;
  height:20px;
  width:100%;
  background:rgb(255,255,255);
}


div.app{
  position:fixed;
  top:20px;
  left:0px;
  width:100%;
  bottom:0px;
  background:rgb(240,240,240);
}
div.swipeFrame{
  height:100%;
  width:auto;
  overflow:hidden;
}
div.swipeFrame div.swipe-wrap{
  height:100%;
}
div.swipeFrame div.swipe-wrap div.pane{
  width:100%;
  height:100%;
  overflow:hidden;
  background:rgb(240,240,240);
  position:relative;
  float:left;
}
div.swipeFrame div.swipe-wrap div.pane iframe{
  position:absolute;
  top:0px;
  left:0px;
  height:100%;
  width:100%;
  border:none;
  padding:0px;
  margin:0px;
}
</style>
<html>
<head>
<meta charset="utf-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="msapplication-tap-highlight" content="no" />
<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
<title>Sealed</title>

<link rel="stylesheet" href="/resources/CSS/resets.css"></link>
<link rel='stylesheet' href='/resources/CSS/lato.css'/></link>
<link rel='stylesheet' href='/resources/CSS/secretcode.css'/></link>
<link rel='stylesheet' href='/resources/CSS/console.css'/></link>
<link rel='stylesheet' href='/resources/CSS/prettyprint.css'/></link>

<link rel='stylesheet' href='/resources/CSS/console.css'/></link>

<script src='/resources/Scripts/swipe.js'></script>
<script src='/resources/Scripts/Request.js'></script>
<script src='/resources/Scripts/Transition.js'></script>
<script src='/resources/Scripts/TrackEventListeners.js'></script>
<script src='/resources/Scripts/Console.js'></script>
<script src='/resources/Scripts/PrettyPrint.js'></script>

<script type="text/javascript" src="cordova.js"></script>

</head>
<body>



<div class='statusbar'></div>


<div class='app'>
  <div id='appbody' class='swipe swipeFrame'>
    <div class='swipe-wrap'>
      <div class='pane'>
        <iframe data-src='./frames/settings.html'></iframe>
      </div>
      <div class='pane'>
        <iframe data-src='./frames/list.html'></iframe>
        <iframe data-src='./frames/signup.html'></iframe>
      </div>
    </div>
  </div>
</div>





<script type='text/javascript'>



var app = new (function(){
  
  var self = this;
  
  self.__gateway__ = 'http://192.168.1.19:8092/api/';
  
  // pops up a native alert
  self.alert = Alert;
  // selects an element in this HTML document by id
  self.select = Select;
  // When an iFrame is ready, it calls this method to notify the app
  // that is has been loaded. It provides its app delegate.
  self.notify = Notify;
  // Given a app delegate, this removes the corresponding iframe
  self.remove = Remove;
  // Loads the app, sets up iframes, libraries, etc...
  self.load = Load;
  // on device read
  self.deviceready = OnDeviceReady;
  // forms a request, useful for iframes which don't import Request.js
  // so that the gateway can be set by the app.
  self.request = FormRequest;
  // provides device information
  self.device = new Device();
  // the swip object (set when bound on load function)
  self.swipe = null
  // give boolean to set, give nothing to recieve current status
  self.debugging = Debugging;
  
  self.console = null;
  
  var isDebugging = false;
  function Debugging(opts){
    if(opts == null || opts == undefined) return isDebugging;
    if(opts.constructor != Boolean) return;
    isDebugging = opts;
  }
  
  function Remove(appdelegate, options){
    var index = delegates.indexOf(appdelegate);
    if(appdelegate == -1) return;
    var delegate = delegates[index];
    delegates.splice(index,1);
    var iframe = getIframeByDelegate(appdelegate);
    // if fade is true, then fade before deleting
    if(options.fade){
      Transition.EaseInOut(300, function(percent){
        iframe.style.opacity = 1-percent;
      }, function(){
        RemoveElement();
      });
    }else{
      RemoveElement();
    }
    // actually removes the iframe
    function RemoveElement(){
      iframe.parentElement.removeChild(iframe);
    }
  }
  
  function getIframeByDelegate(delegate){
    var appbody = self.select('appbody'),
        iframes = appbody.getElementsByTagName('iframe');
    for(var i=0,iframe; iframe=iframes[i++];)
      if(iframe.contentWindow.delegate == delegate)
        return iframe;
  }
  
  function getIframeDocument(iframe){
    return iframe.contentDocument || iframe.contentWindow.document;
  }
  
  function Device(){
    this.isAndriod = function(){return /Android/i.test(navigator.userAgent);}
    this.isBlackBerry = function(){return /BlackBerry/i.test(navigator.userAgent);}
    this.isIOS = function(){return /iPhone|iPad|iPod/i.test(navigator.userAgent);}
    this.isWindows = function(){return /IEMobile/i.test(navigator.userAgent);}
    this.isMobile = function(){return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Windows());}
  }
  
  function FormRequest(url){
    return new Request(url);
  }
  
  var deviceReady = false;
  function OnDeviceReady(){
    deviceReady = true;
    NotifyIframes();
  }
  
  function Alert(message, title){
    var message = message + '',
        title =   title   + '';
    if (!!navigator.notification)
      navigator.notification.alert(message, null, title, 'OK');
    else
      alert(title ? (title + ": " + message) : message);
  }
  
  function Select(id){
    return document.getElementById(id);
  }
  
  function Load(){
    LoadSwiping();
    LoadIframes();
    LoadLibraries();
    LoadConsole();
  }
  function LoadIframes(){
    var appbody = self.select('appbody'),
        iframes = appbody.getElementsByTagName('iframe');
    totalIframes = iframes.length;
    for(var i=0,iframe; iframe=iframes[i++];)
      iframe.src = iframe.getAttribute('data-src');
  }
  function LoadLibraries(){
    Request.loadGateway(self.__gateway__);
  }
  function LoadSwiping(){
    var appbody = self.select('appbody');
    self.swipe = Swipe(appbody,{
      continuous: false,
      startSlide: 1,
      callback: function(index, element) {}
      // disableScroll: true
      // stopPropagation: true,
      // transitionEnd: function(index, element) {}
    });
  }
  function LoadConsole(){
    self.console = new Console();
    var lasttap = 0;
    self.console.__frame__.addEventListener('touchstart', function(event){
      if(Date.now()-lasttap < 200)
        app.console.openclose();
      lasttap = Date.now();
    });
  }
  
  var delegates = [],
      totalIframes;
  function Notify(appdelegate){
    delegates.push(appdelegate);
    BindTouchEvents(appdelegate);
    NotifyIframes();
  }
  function NotifyIframes(){
    if(delegates.length == totalIframes && deviceReady)
      for(var i=0,delegate; delegate=delegates[i++];)
        (delegate.onload || new Function())();
  }
  function BindTouchEvents(appdelegate){
    var iframe = getIframeByDelegate(appdelegate),
        doc = getIframeDocument(iframe);
    var lasttap = 0;
    doc.addEventListener('touchstart', function(event){
      if(Date.now()-lasttap < 200 && self.debugging())
        app.console.openclose();
      lasttap = Date.now();
      self.select('appbody').children[0].getEventListeners('touchstart').dispatch(event);
    });
    doc.addEventListener('touchend', function(event){
      app.console.log(event)
      self.select('appbody').children[0].getEventListeners('touchend').dispatch(event);
    });
    doc.addEventListener('touchmove', function(event){
      self.select('appbody').children[0].getEventListeners('touchmove').dispatch(event);
    });
  }
  
})();









app.debugging(true);

document.addEventListener('deviceready', app.deviceready, false);
window.onload = app.load;

</script>
</body>
</html>
